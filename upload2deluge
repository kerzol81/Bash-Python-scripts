#!/bin/bash

# Prior to running a passwordless ssh key must be generated and uploaded to the server
# then run it by cron in every minute

local_path='/home/zoli/downloads/'
torrents=`find . -type f -name '*torrent' | wc -l`
server_path='root@10.0.0.4:/home/deluge/torrents/'
server='10.0.0.4'

cd "$local_path"

if [ "$torrents" -eq 0 ];
then
	exit 1
fi


for i in *.torrent
	do 
		scp -i ~/.ssh/id_rsa "$i" "$server_path";	
		if [ $? -ne 0 ];
			then
			exit 2
		fi
	done

find "$local_path" -type f -name '*torrent' -exec rm -f {} \;

exit 0

